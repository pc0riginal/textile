{% extends "base.html" %}

{% block title %}Create Company - Textile ERP{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Page Header -->
    <div>
        <h1 class="text-2xl font-bold text-gray-900">Create New Company</h1>
        <p class="text-gray-600">Add a new business entity to your account</p>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        {% if error %}
        <div class="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md">
            {{ error }}
        </div>
        {% endif %}

        <form method="POST" action="/companies/create" class="space-y-6" onsubmit="return validateForm()">
            <!-- Basic Information -->
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Company Name *</label>
                        <input type="text" id="name" name="name" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <span id="name-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div>
                        <label for="gstin" class="block text-sm font-medium text-gray-700 mb-2">GSTIN *</label>
                        <input type="text" id="gstin" name="gstin" maxlength="15" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 uppercase"
                               placeholder="22AAAAA0000A1Z5" oninput="this.value = this.value.toUpperCase()">
                        <span id="gstin-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div>
                        <label for="pan" class="block text-sm font-medium text-gray-700 mb-2">PAN</label>
                        <input type="text" id="pan" name="pan" maxlength="10"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 uppercase"
                               placeholder="AAAAA0000A" oninput="this.value = this.value.toUpperCase()">
                        <span id="pan-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div>
                        <label for="financial_year" class="block text-sm font-medium text-gray-700 mb-2">Financial Year *</label>
                        <input type="text" id="financial_year" name="financial_year" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="YYYY-YYYY">
                        <span id="financial_year-error" class="text-xs text-red-600 hidden"></span>
                        <p class="text-xs text-gray-500 mt-1">Format: YYYY-YYYY (e.g., 2024-2025)</p>
                    </div>
                </div>
            </div>

            <!-- Address -->
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">Address</h3>
                <div class="space-y-4">
                    <div>
                        <label for="address_line1" class="block text-sm font-medium text-gray-700 mb-2">Address Line 1 *</label>
                        <input type="text" id="address_line1" name="address_line1" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <span id="address_line1-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div>
                        <label for="address_line2" class="block text-sm font-medium text-gray-700 mb-2">Address Line 2</label>
                        <input type="text" id="address_line2" name="address_line2"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="city" class="block text-sm font-medium text-gray-700 mb-2">City</label>
                            <input type="text" id="city" name="city"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="state" class="block text-sm font-medium text-gray-700 mb-2">State</label>
                            <input type="text" id="state" name="state"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label for="pincode" class="block text-sm font-medium text-gray-700 mb-2">Pincode</label>
                            <input type="text" id="pincode" name="pincode" maxlength="6"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <span id="pincode-error" class="text-xs text-red-600 hidden"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">Contact Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                        <input type="tel" id="phone" name="phone" required maxlength="10"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <span id="phone-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" name="email"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <span id="email-error" class="text-xs text-red-600 hidden"></span>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="website" class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                        <input type="url" id="website" name="website"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="https://www.example.com">
                    </div>
                </div>
            </div>

            <!-- Document Series -->
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">Document Series</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="invoice_series" class="block text-sm font-medium text-gray-700 mb-2">Invoice Series</label>
                        <input type="text" id="invoice_series" name="invoice_series" value="INV"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Invoices will be numbered as INV0001, INV0002, etc.</p>
                    </div>
                    
                    <div>
                        <label for="challan_series" class="block text-sm font-medium text-gray-700 mb-2">Challan Series</label>
                        <input type="text" id="challan_series" name="challan_series" value="CH"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Challans will be numbered as CH0001, CH0002, etc.</p>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="/companies" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                    Create Company
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Set current financial year on page load
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const month = today.getMonth() + 1;
    const year = today.getFullYear();
    
    // Financial year starts in April (month 4)
    let fyStart, fyEnd;
    if (month >= 4) {
        fyStart = year;
        fyEnd = year + 1;
    } else {
        fyStart = year - 1;
        fyEnd = year;
    }
    
    document.getElementById('financial_year').value = fyStart + '-' + fyEnd;
});

function validateForm() {
    let isValid = true;
    let firstError = null;
    
    // Clear previous errors
    document.querySelectorAll('[id$="-error"]').forEach(el => {
        el.classList.add('hidden');
        el.textContent = '';
    });
    document.querySelectorAll('input').forEach(el => el.classList.remove('border-red-500'));
    
    // Validate name
    const name = document.getElementById('name');
    if (!name.value.trim()) {
        showError('name', 'Company name is required');
        isValid = false;
        if (!firstError) firstError = name;
    }
    
    // Validate GSTIN
    const gstin = document.getElementById('gstin');
    if (!gstin.value.trim()) {
        showError('gstin', 'GSTIN is required');
        isValid = false;
        if (!firstError) firstError = gstin;
    } else if (gstin.value.length !== 15) {
        showError('gstin', 'GSTIN must be exactly 15 characters');
        isValid = false;
        if (!firstError) firstError = gstin;
    }
    
    // Validate PAN
    const pan = document.getElementById('pan');
    if (pan.value && pan.value.length !== 10) {
        showError('pan', 'PAN must be exactly 10 characters');
        isValid = false;
        if (!firstError) firstError = pan;
    }
    
    // Validate Financial Year
    const fy = document.getElementById('financial_year');
    if (!fy.value.trim()) {
        showError('financial_year', 'Financial year is required');
        isValid = false;
        if (!firstError) firstError = fy;
    } else if (!/^\d{4}-\d{4}$/.test(fy.value)) {
        showError('financial_year', 'Financial year must be in format YYYY-YYYY');
        isValid = false;
        if (!firstError) firstError = fy;
    } else {
        const [start, end] = fy.value.split('-').map(Number);
        if (end !== start + 1) {
            showError('financial_year', 'End year must be start year + 1');
            isValid = false;
            if (!firstError) firstError = fy;
        }
    }
    
    // Validate address
    const address = document.getElementById('address_line1');
    if (!address.value.trim()) {
        showError('address_line1', 'Address line 1 is required');
        isValid = false;
        if (!firstError) firstError = address;
    }
    
    // Validate pincode
    const pincode = document.getElementById('pincode');
    if (pincode.value && !/^[0-9]{6}$/.test(pincode.value)) {
        showError('pincode', 'Pincode must be exactly 6 digits');
        isValid = false;
        if (!firstError) firstError = pincode;
    }
    
    // Validate phone
    const phone = document.getElementById('phone');
    if (!phone.value.trim()) {
        showError('phone', 'Phone is required');
        isValid = false;
        if (!firstError) firstError = phone;
    } else if (!/^[0-9]{10}$/.test(phone.value)) {
        showError('phone', 'Phone must be exactly 10 digits');
        isValid = false;
        if (!firstError) firstError = phone;
    }
    
    // Validate email
    const email = document.getElementById('email');
    if (email.value && !/^[\w\.-]+@[\w\.-]+\.\w+$/.test(email.value)) {
        showError('email', 'Invalid email format');
        isValid = false;
        if (!firstError) firstError = email;
    }
    
    if (!isValid && firstError) {
        firstError.focus();
        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    return isValid;
}

function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const error = document.getElementById(fieldId + '-error');
    field.classList.add('border-red-500');
    error.textContent = message;
    error.classList.remove('hidden');
}
</script>
{% endblock %}